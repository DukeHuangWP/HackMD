<style>



  /*--------------- view ---------------*/
  body[style],
  body[style*="background-color: white;"] {
    background-color: #444444 !important;
  }

  body {
    color: #abb2bf;
  }

}

  .ui-view-area,
  .markdown-body,
  .ui-content {
    background: #444444;
    color: #abb2bf;
  }
  



  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  p {
    color: #ddd;
  }

  hr  {
    border-color: #6d6d6d;
  }
  .part code{
    background-color: #999900;
  }

  /* form */
  .form-control {
    background: #333;
    color: #fff;

  }

  .form-control::placeholder,
  .form-control::-webkit-input-placeholder,
  .form-control:-moz-placeholder,
  .form-control::-moz-placeholder,
  .form-control:-ms-input-placeholder {
    color: #eee;
  }

  /*--------------- navbar ---------------*/
  .header,
  .navbar {
    background-color: #0e0e0e;
    border-color: #0e0e0e;
  }

  .navbar a {
    color: #eee !important;
  }

  .navbar .btn-group label {
    background-color: #0e0e0e;
    color: #eee;
    border-color: #555;
  }

  .navbar .btn-group label.btn-default:focus,
  .navbar .btn-group label.btn-default:hover {
    background-color: #2a2a2a;
    color: #eee;
    border-color: #555;
  }


  .navbar .btn-group label.active,
  .navbar .btn-group label.active:focus,
  .navbar .btn-group label.active:hover {
    background-color: #555;
    color: #eee;
    border-color: #555;
  }

  .navbar-default .btn-link:focus,
  .navbar-default .btn-link:hover {
    color: #eee;
  }

  .navbar-default .navbar-nav>.open>a,
  .navbar-default .navbar-nav>.open>a:focus,
  .navbar-default .navbar-nav>.open>a:hover {
    background-color: #555;
  }

  .dropdown-header {
    color: #aaa;
  }

  .dropdown-menu {
    background-color: #222;
    border: 1px solid #555;
    border-top: none;
  }

  .dropdown-menu>li>a {
    color: #eee;
  }

  .dropdown-menu>li>a:focus,
  .dropdown-menu>li>a:hover {
    background-color: #555555;
    color: #eee;
  }

  .dropdown-menu .divider {
    background-color: #555;
  }

  .header .open .dropdown-menu {
    background-color: #202020;
  }

  .navbar .announcement-popover {
    background: #4F4F4F;
  }

  .navbar .announcement-popover .announcement-popover-header {
    background: #2e2e2e;
    border-bottom: 1px solid #2e2e2e;
  }

  .navbar .announcement-popover .announcement-popover-body {
    background: #4F4F4F;
    color: #eee;
  }

  .navbar .announcement-popover .announcement-popover-footer {
    background: #4F4F4F;
  }

  .navbar .announcement-area .caption.inverse {
    color: #eee;
  }

  .label-warning {
    background-color: #ffc107;
    color: #212529;
  }

  /*--------------- history / recent ---------------*/
  .list.row-layout li .item {
    border-color: #696c7d;
  }

  .list.row-layout li:nth-last-of-type(1) .item {
    border-bottom: none;
  }

  .list li .item {
    background: #1c1c1c;
  }

  .list li:hover .item,
  .list li:focus .item {
    background: #404040;
  }

  .list li .item h4 {
    color: #fff;
  }

  .list li p {
    color: #ccc;
  }

  .list li p i {
    font-style: normal;
  }

  .list li .item .content .tags span {
    background: #555;
  }

  .list li .item.wide .content .title a,
  .list li .item.wide .content .title a:focus,
  .list li .item.wide .content .title a:hover {
    color: #ddd;
  }

  .ui-item {
    color: #fff;
    opacity: 0.7;
  }

  .ui-item:hover,
  .ui-item:focus {
    opacity: 1;
    color: #fff;
  }

  .list li .item.wide hr {
    border-color: #6d6d6d;
  }

  .overview-widget-group .btn,
  .multi-select-dropdown-menu .ui-dropdown-label,
  .multi-select-dropdown-menu .dropdown-options,
  .form-control {
    border-color: #6d6d6d;
  }

  .multi-select-dropdown-menu .dropdown-options .ui-option:hover {
    background-color: #4d4d4d;
    color: #eee;
  }

  #overview-control-form #overview-keyword-input-container .select2-container {
    background-color: #3e4045 !important;
  }

  #overview-control-form #overview-keyword-input-container .select2-container .select2-choices {
    background-color: #3e4045;
  }

  .search {
    background-color: #3e4045;
    color: #eee;
  }

  .btn.btn-gray {
    background: #1b1b1b;
  }

  .btn.btn-gray:hover {
    background: #4d4d4d;
    color: #eee;
  }

  .search::placeholder,
  .search::-webkit-input-placeholder,
  .search:-moz-placeholder,
  .search::-moz-placeholder,
  .search:-ms-input-placeholder {
    color: #eee;
  }

  .btn.btn-gray {
    border-color: #6d6d6d;
    background: #333;
    color: #eee;
  }

  .select2-default {
    color: #eee !important;
  }

  .select2-results .select2-highlighted {
    background: #4d4d4d;
    color: #eee;
  }

  .select2-container-multi .select2-choices {
    background: #3e4045;
  }

  .select2-container-multi .select2-choices .select2-search-choice {
    background: #131313;
    color: #eee;
    border-color: #555;
    box-shadow: none;
  }

  .btn-default,
  .btn-default:focus {
    color: #eee;
    background-color: #2e2e2e;
    border-color: #6a6a6a;
  }

  .btn-default.active.focus,
  .btn-default.active:focus,
  .btn-default.active:hover,
  .btn-default:active.focus,
  .btn-default:active:focus,
  .btn-default:active:hover,
  .open>.dropdown-toggle.btn-default.focus,
  .open>.dropdown-toggle.btn-default:focus,
  .open>.dropdown-toggle.btn-default:hover {
    background: #737373;
  }

  .btn-default:hover {
    color: #fff;
    background-color: #7d7d7d;
    border-color: #6a6a6a;
  }

  .overview-widget-group .btn.active {
    background-color: #6a6a6a;
    color: #eee;
  }

  .overview-widget-group .btn:hover {
    background-color: #7d7d7d;
    color: #eee;
    border-color: #636363;
  }

  .overview-widget-group .slider.round {
    border-color: #ccc;
  }

  .overview-widget-group .slider.round:before {
    border-color: #ccc;
  }

  .overview-widget-group input:checked+.slider {
    background-color: #ccc;
  }

  .ui-category-description-icon a {
    color: #eee;
  }

  .item .ui-history-pin.active {
    color: #f00;
  }

  .ui-history-close {
    color: #eee;
    opacity: 0.5;
  }

  .pagination>li>a,
  .pagination>li>span {
    color: #eee;
    background-color: #2e2e2e;
    border-color: #6a6a6a;
  }

  .pagination>li>a:hover {
    color: #fff;
    background-color: #7d7d7d;
    border-color: #6a6a6a;
  }

  .pagination>.disabled>a,
  .pagination>.disabled>a:focus,
  .pagination>.disabled>a:hover,
  .pagination>.disabled>span,
  .pagination>.disabled>span:focus,
  .pagination>.disabled>span:hover {
    color: #eee;
    background-color: #2e2e2e;
    border-color: #6a6a6a;
  }

  .pagination.dark>li>a,
  .pagination.dark>li>span {
    color: #aaa;
  }

  /*--------------- settings ---------------*/
  .section .form-horizontal .form-group .btn-default {
    font-size: 16px;
    border-color: #6d6d6d;
    background-color: #333;
    color: #FFF;
  }

  .section .form-horizontal .form-group .btn-default:hover,
  .section .form-horizontal .form-group .btn-default:focus {
    background-color: #737373;
    color: #FFF;
  }

  .section .form-horizontal .form-control:focus {
    border-color: #bbb;
  }

  /*--------------- share view ---------------*/
  #notificationLabel,
  .ui-infobar .btn.ui-edit {
    color: #eee;
    border-color: #6a6a6a;
  }

  .ui-infobar__user-info li {
    color: #bbb;
  }

  footer {
    background: #101010;
    color: #bbb;
    border-top: 1px solid #454545;
  }

  footer a {
    color: #bbb;
  }

  /*--------------- doc view ---------------*/
  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6,
  .markdown-body hr,
  #doc>h1 {
    color: #ddd;
    border-color: #777 !important;
  }

  .h1 .small,
  .h1 small,
  .h2 .small,
  .h2 small,
  .h3 .small,
  .h3 small,
  .h4 .small,
  .h4 small,
  .h5 .small,
  .h5 small,
  .h6 .small,
  .h6 small,
  h1 .small,
  h1 small,
  h2 .small,
  h2 small,
  h3 .small,
  h3 small,
  h4 .small,
  h4 small,
  h5 .small,
  h5 small,
  h6 .small,
  h6 small {
    color: #ddd;
  }

  .markdown-body p {
    color: #ddd;
  }

  .markdown-body a {
    color: #7bf;
  }

  .markdown-body a code {
    color: #7bf !important;
  }

  .markdown-body ul li,
  .markdown-body ol li {
    color: #ddd;
  }

  .markdown-body blockquote {
    color: #ddd;
    border-left-color: #777;
    font-size: 16px;
  }

  <--.markdown-body code,
  code {
    color: #dfdfdf !important;
    background-color: #424a55;
  }-->

  .markdown-body pre {
    background-color: #1e1e1e;
    border: 1px solid #555 !important;
    color: #dfdfdf;
  }

  blockquote .small,
  blockquote footer,
  blockquote small {
    color: #bbb;
  }

  .mark,
  mark {
    background-color: rgba(255, 255, 0, 0.32) !important;
    color: #ddd;
    margin: .1em;
    padding: .1em .2em;
  }

  /* Todo list */
  .task-list-item-checkbox {
    margin: 0.18em 0 0.2em -1.3em !important;
  }

  .task-list-item input[type=checkbox] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    position: relative;
    top: -1px;
    margin: 0 1rem 0 0;
    cursor: pointer;
  }

  .task-list-item input[type=checkbox]::before {
    -webkit-transition: all 0.1s ease-in-out;
    -moz-transition: all 0.1s ease-in-out;
    transition: all 0.1s ease-in-out;
    content: "";
    position: absolute;
    left: 0;
    z-index: 1;
    width: 16px;
    height: 16px;
    border: 2px solid #F44336;
  }

  .task-list-item input[type=checkbox]:checked::before {
    -webkit-transform: rotate(-48deg);
    -moz-transform: rotate(-48deg);
    -ms-transform: rotate(-48deg);
    -o-transform: rotate(-48deg);
    transform: rotate(-48deg);
    height: 9px;
    border-color: #00E676;
    border-top-style: none;
    border-right-style: none;
  }

  .task-list-item input[type=checkbox]::after {
    content: "";
    position: absolute;
    top: -0.125rem;
    left: 0;
    width: 16px;
    height: 16px;
    background: #333;
    cursor: pointer;
  }

  /* table */
  .markdown-body table tr {
    background-color: #1e1e1e;
    border-top: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  }

  .markdown-body table tr:first-child {
    border-top: 1px solid rgba(255, 255, 255, 0.2);
  }

  .markdown-body table tr:nth-child(2n) {
    background-color: #333;
  }

  .markdown-body table tr th {
    color: #64B5F6;
  }

  .markdown-body table th,
  .markdown-body table td {
    border: none;
  }

  .markdown-body table tr th:first-child,
  .markdown-body table tr td:first-child {
    border-left: 1px solid rgba(255, 255, 255, 0.1);
  }

  .markdown-body table tr th:last-child,
  .markdown-body table tr td:last-child {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
  }

  .markdown-body table tr td {
    color: #ddd;
  }



  .markdown-body pre.flow-chart,
  .markdown-body pre.sequence-diagram,
  .markdown-body pre.graphviz,
  .markdown-body pre.mermaid,
  .markdown-body pre.abc {
    background-color: #1e1e1e;
    color: #ddd;



  }
              .markdown-body pre.gri {
                stroke: lightgrey;
                opacity: 0.3;
                shape-rendering: crispEdges;
            }
            .markdown-body pre.grid path {
                stroke-width: 0;
            }
  


  /* alert */
  .alert h1,
  .alert h2,
  .alert h3,
  .alert h4,
  .alert h5,
  .alert h6,
  .alert p,
  .alert ul li,
  .alert ol li {
    color: #31708f;
  }

  .alert a {
    color: #002752;
    font-weight: 700;
  }

  .alert h1:first-child,
  .alert h2:first-child,
  .alert h3:first-child,
  .alert h4:first-child,
  .alert h5:first-child,
  .alert h6:first-child {
    margin-top: 0;
  }

  .markdown-body .alert>p {
    margin-top: 0px;
    margin-bottom: 10px;
  }

  .markdown-body .alert>ul,
  .markdown-body .alert>ol {
    margin-bottom: 16px;
  }

  .markdown-body .alert>*:last-child {
    margin-bottom: 0;
  }

  .alert-warning {
    background-color: #fff3cd;
    border-color: #ffeeba;
  }

  /* scroll bar */
  .ui-edit-area .ui-resizable-handle.ui-resizable-e {
    background-color: #303030;
    border: 1px solid #303030;
    box-shadow: none;
  }

  /* info bar */
  .ui-infobar {
    color: #999;
  }

  /* permission */
  .permission-popover-btn-group .btn.focus,
  .permission-popover-btn-group .btn:active,
  .permission-popover-btn-group .btn:focus,
  .permission-popover-btn-group .btn.active {
    background-color: #6a6a6a !important;
    color: #eee !important;
    border-color: #555 !important;
  }

  .permission-popover-btn-group .btn:hover,
  .permission-popover-btn-group .btn.active:hover {
    background-color: #7d7d7d !important;
    color: #eee !important;
    border-color: #636363 !important;
  }

  .ui-delete-note a:hover,
  .ui-delete-note a:focus,
  .ui-delete-note a:active {
    background-color: #dc3545 !important;
  }

  .ui-invitee-invite {
    border-color: #6a6a6a !important;
  }

  .ui-invitee-invite:hover,
  .ui-invitee-invite:focus {
    background-color: #737373;
    color: #eee !important;
  }

  .ui-invitee.ui-invitee-list .ui-invitee-remove,
  .ui-invitee.ui-invitee-list .ui-invitee-remove:hover,
  .ui-invitee.ui-invitee-list .ui-invitee-remove:focus,
  .ui-invitee.ui-invitee-list .ui-invitee-remove:active {
    background-color: #dc3545;
    border: 1px solid #dc3545;
  }

  .select2-container {
    background: #202020;
  }

  .select2-container-multi .select2-choices .select2-search-field input {
    color: #eee;
  }

  .select2-container-multi .select2-choices .select2-search-field input.select2-active {
    color: #000;
  }

  .select2-drop {
    background: #202020;
    color: #eee;
  }

  .select2-results .select2-no-results,
  .select2-results .select2-searching,
  .select2-results .select2-ajax-error,
  .select2-results .select2-selection-limit {
    background: #202020;
  }

  /* table of contents block*/
  .ui-toc-dropdown {
    width: 42vw;
    max-height: 90vh;
    overflow: auto;
    text-align: inherit;
  }

  /* table of contents text*/
  .ui-toc-dropdown .nav>li>a {
    font-size: 14px;
    font-weight: bold;
    color: #ddd;
  }

  /* table of contents text: active*/
  .ui-toc-dropdown .nav>.active:focus>a,
  .ui-toc-dropdown .nav>.active:hover>a,
  .ui-toc-dropdown .nav>.active>a {
    color: #7bf;
    border-left-color: #7bf;
  }

  /* table of contents text: focus, hover*/
  .ui-toc-dropdown .nav>li>a:focus,
  .ui-toc-dropdown .nav>li>a:hover {
    color: #7bf;
    border-left-color: #7bf;
  }

  /* drop down floating table of contents */
  .ui-toc-dropdown.dropdown-menu {
    background: #333;
  }

  .toc-menu a {
    color: #ddd;
  }

  .toc-menu a:focus,
  .toc-menu a:hover {
    color: #7bf;
  }


  /*--------------- editor ---------------*/
  .cm-m-markdown {
    color: #ddd;
  }

  .cm-s-one-dark .cm-header,
  .cm-m-xml.cm-attribute {
    color: #ffa653;
  }

  .cm-s-one-dark .cm-string,
  .cm-s-one-dark .cm-variable-2 {
    color: #7bf;
  }

  .cm-m-markdown.cm-variable-3 {
    color: #ff7e7e;
  }

  .cm-s-one-dark .cm-link {
    color: #b0ee83;
  }

  .cm-s-one-dark .CodeMirror-linenumber {
    color: #666;
  }

  .cm-strong {
    color: #f4511e;
  }

  .cm-s-one-dark .cm-comment {
    color: #a9a9a9;
  }

  .cm-matchhighlight {
    color: #ffea00;
  }

  .cm-positive {
    color: #11bf64;
  }

  .cm-negative {
    color: #ff3e3e;
  }

  .dropdown-menu.CodeMirror-other-cursor {
    border: 2px solid #4d4d4d;
    background-color: #202020;
  }

  .dropdown-menu.CodeMirror-other-cursor li a {
    color: #ececec;
  }

  /*--------------- book mode ---------------*/
  .topbar {
    background: #1e1e1e;
  }

  .btn.focus,
  .btn:focus,
  .btn:hover {
    color: #aaa;
  }

  .summary {
    background: #1e1e1e;
  }

  .summary,
  .toolbar {
    background: #1e1e1e !important;
    border-color: #4d4d4d !important;
  }

  .toolbar i {
    color: #fff;
  }

  .summary h1,
  .summary h2,
  .summary h3 .summary hr {
    color: #ddd;
    border-color: #777 !important;
  }

  .summary .nav>li>a {
    color: #7bf;
  }

  .summary .nav-pills>li.active>a,
  .summary .nav-pills>li.active>a:focus,
  .summary .nav-pills>li.active>a:hover {
    color: #ff9100;
  }

  .ui-summary-search {
    font-size: 16px;
    border: 1px solid #6D6D6D;
    background-color: #333;
    color: #FFF;
  }

  .summary h1,
  .summary h2,
  .summary h3,
  .summary h4,
  .summary h5,
  .summary h6 {
    border-color: #454545;
  }

  /* fix body background color to dark */
  div[class$=container-mask] {
    background: #1e1e1e;
    z-index: 1;
    display: block;
  }

  /* notification */
  .dropdown.ui-notification .ui-notification-label,
  .dropdown.ui-invitee .ui-invitee-label {
    color: #eee;
    border-color: #6a6a6a;
  }

  .ui-notification .dropdown-menu {
    border-top: 1px solid #555;
  }

  /*--------------- help ---------------*/
  .modal-header {
    background-color: #2a2a2a;
  }

  .panel-default {
    border-color: #6d6d6d;
  }

  .panel-default>.panel-heading {
    background-color: #2a2a2a;
    color: #eee;
    border-color: #6d6d6d;
  }

  .panel-body {
    background: #2e2e2e;
  }

  .panel-body a {
    color: #7bf;
  }

  .table>tbody>tr>td,
  .table>tbody>tr>th,
  .table>tfoot>tr>td,
  .table>tfoot>tr>th,
  .table>thead>tr>td,
  .table>thead>tr>th {
    border-color: #6d6d6d;
  }

  /*--------------- comment ---------------*/
  .ui-comment-container .ui-comment-header {
    background-color: #2a2a2a;
    color: #eee;
    border-color: #6d6d6d;
  }

  .ui-comment-container {
    background-color: #2e2e2e;
    border-color: #6d6d6d;
  }

  .ui-comment-container .ui-comments-container .ui-comment .comment-author {
    color: #eee;
  }

  .ui-comment-container .ui-comments-container .ui-comment .timestamp {
    color: #aaa;
  }

  .ui-comment-container .ui-comments-container .ui-comment .comment-content {
    color: #eee;
  }

  .ui-comment-container .ui-comments-container .ui-comment .comment-menu {
    color: #eee;
  }

  .ui-comment-container .ui-comments-container .ui-comment .comment-menu .comment-dropdown-menu {
    background: #222;
    color: #eee;
    border-color: #555;
  }

  .ui-comment-container .ui-comments-container .ui-comment .comment-menu .comment-dropdown-menu>div:hover {
    background-color: #555555;
    color: #eee;
  }

  .ui-comment-container .ui-comments-container .ui-comment .comment-menu:hover,
  .ui-comment-container .ui-comments-container .ui-comment .comment-menu:active,
  .ui-comment-container .ui-comments-container .ui-comment .comment-menu.active {
    background-color: #737373;
    color: #eee;
  }

  .ui-comment-container .ui-comment-input-container {
    background-color: #3c3c3c;
  }

  .ui-comment-container textarea {
    background-color: #3e4045;
    color: #eee;
    border: 1px solid #6d6d6d;
  }

  .ui-comment-container textarea::placeholder,
  .ui-comment-container textarea::-webkit-input-placeholder,
  .ui-comment-container textarea:-moz-placeholder,
  .ui-comment-container textarea::-moz-placeholder,
  .ui-comment-container textarea:-ms-input-placeholder {
    color: #eee;
  }

  @keyframes highlight {
    0% {
      background-color: #3c3c3c;
    }

    30% {
      background-color: #3c3c3c;
    }

    100% {
      background-color: transparent;
    }
  }

  /*--------------- template ---------------*/
  .template-content .modal-header {
    background: #2a2a2a;
  }

  .template-content .close {
    color: #fff;
  }

  .template-content .modal-title {
    color: #eee;
  }

  .template-content .ui-templates-container {
    border-color: #6d6d6d;
  }

  .ui-templates-container .ui-create-template-btn {
    background: #446fab;
    color: #fff;
  }

  .ui-template-list-filter .ui-template-list-filter-label,
  .ui-template-list-filter .ui-template-list-filter-label:hover {
    color: #eee;
  }

  .ui-template-list .list-group-item.active {
    background: #4d4d4d;
  }

  .ui-template-list .list-group-item.active:focus {
    background: #4d4d4d !important;
  }

  .list-group-item.active,
  .list-group-item.active:focus,
  .list-group-item.active:hover {
    color: #eee;
  }

  .ui-template-list .list-group-item .list-group-item-heading {
    color: #eee;
  }

  .ui-template-list .list-group-item.active .list-group-item-heading {
    color: #eee;
  }

  .ui-template-list .list-group-item:hover {
    background: #4d4d4d !important;
  }

  .ui-template-item-menu {
    color: #eee !important;
  }

  .ui-template-list .list-group-item {
    color: #fff;
  }

  .ui-template-list .list-group-item .dropdown-container.open {
    background-color: #2a2a2a;
  }

  .ui-template-list .list-group-item .dropdown-container:hover {
    background-color: #2a2a2a !important;
  }

  .template-menu .more-template {
    border-color: #6d6d6d;
  }

  .template-menu .more-template:hover {
    color: #eee;
    border-color: #6d6d6d;
  }

  /*--------------- code mirror ---------------*/
  .modal-content {
    background: #1f2226;
  }

  .modal-header {
    border-bottom: 1px solid #46484f;
  }

  .modal-footer {
    border-top: 1px solid #46484f;
  }

  a.list-group-item {
    background: #1f2226;
    color: #ddd;
    border: 1px solid #46484f;
  }

  a.list-group-item .list-group-item-heading {
    color: #ddd;
  }

  a.list-group-item:focus,
  a.list-group-item:hover {
    background: #434651;
    color: #ddd;
  }

  button.close {
    color: #ddd;
    opacity: .5;
  }

  .close:focus, .close:hover {
    color: #fff;
    opacity: .8;
  }

  .CodeMirror {
    background: #1f2226;
  }

  .CodeMirror-gutters {
    background: #1f2226;
    border-right: 1px solid rgba(204, 217, 255, 0.1);
  }

  .cm-s-default .cm-comment {
    color: #888;
  }

  .cm-s-default .cm-quote {
    color: #ddd;
  }

  .cm-s-default .cm-header {
    color: #ffa653;
  }

  .cm-s-default .cm-link {
    color: #b0ee83;
  }

  .cm-s-default .cm-string,
  .cm-s-default .cm-variable-2 {
    color: #7bf;
  }

  .cm-s-default .cm-def {
    color: #c678dd;
  }

  .cm-s-default .cm-number,
  .cm-s-default .cm-attribute,
  .cm-s-default .cm-qualifier,
  .cm-s-default .cm-plus,
  .cm-s-default .cm-atom {
    color: #eda35e;
  }

  .cm-s-default .cm-property,
  .cm-s-default .cm-variable,
  .cm-s-default .cm-variable-3,
  .cm-s-default .cm-operator,
  .cm-s-default .cm-bracket {
    color: #f76e79;
  }

  .cm-s-default .cm-keyword,
  .cm-s-default .cm-builtin,
  .cm-s-default .cm-tag {
    color: #98c379;
  }

  .modal-title {
    color: #ccc;
  }

  .modal-body {
    color: #ccc !important;
  }

  div[contenteditable]:empty:not(:focus):before {
    color: #aaa;
  }

  .CodeMirror pre {
    color: #ddd;
  }

  .CodeMirror pre span[style^="background-color: rgb(221, 251, 230)"] {
    background-color: #288c27 !important;
  }

  .CodeMirror pre span[style^="background-color: rgb(249, 215, 220)"] {
    background-color: #a52721 !important;
  }

  /*------- code highlight: Visual Stutdio Code theme for highlight.js -------*/
  .hljs {
    background: #1E1E1E;
    color: #DCDCDC;
  }

  .hljs-keyword,
  .hljs-literal,
  .hljs-symbol,
  .hljs-name {
    color: #569CD6;
  }

  .hljs-link {
    color: #569CD6;
    text-decoration: underline;
  }

  .hljs-built_in,
  .hljs-type {
    color: #4EC9B0;
  }

  .hljs-number,
  .hljs-class {
    color: #B8D7A3;
  }

  .hljs-string,
  .hljs-meta-string {
    color: #D69D85;
  }

  .hljs-regexp,
  .hljs-template-tag {
    color: #d16969;
  }

  .hljs-title {
    color: #dcdcaa;
  }

  .hljs-subst,
  .hljs-function,
  .hljs-formula {
    color: #DCDCDC;
  }

  .hljs-comment,
  .hljs-quote {
    color: #57A64A;
  }

  .hljs-doctag {
    color: #608B4E;
  }

  .hljs-meta,
  .hljs-meta-keyword,
  .hljs-tag {
    color: #9B9B9B;
  }

  .hljs-variable,
  .hljs-template-variable {
    color: #BD63C5;
  }

  .hljs-params,
  .hljs-attr,
  .hljs-attribute,
  .hljs-builtin-name {
    color: #9CDCFE;
  }

  .hljs-section {
    color: gold;
  }

  .hljs-emphasis {
    font-style: italic;
  }

  .hljs-strong {
    font-weight: bold;
  }

  /*
  .hljs-code {
    font-family:'Monospace';
  }
  */

  .hljs-bullet,
  .hljs-selector-tag,
  .hljs-selector-id,
  .hljs-selector-class,
  .hljs-selector-attr,
  .hljs-selector-pseudo {
    color: #D7BA7D;
  }

  .hljs-addition {
    background-color: #155a36;
    color: #dfdfdf;
    display: inline-block;
    width: 100%;
  }

  .hljs-deletion {
    background-color: #872e2e;
    color: #dfdfdf;
    display: inline-block;
    width: 100%;
  }

  /*---------- code highlight: Visual Stutdio Code theme for Prism.js ----------*/
  code[class*="language-"],
  pre[class*="language-"] {
    color: #DCDCDC;
  }

  :not(pre)>code[class*="language-"],
  pre[class*="language-"] {
    background: #1E1E1E;
  }

  .token.comment,
  .token.block-comment,
  .token.prolog,
  .token.cdata {
    color: #57A64A;
  }

  .token.doctype,
  .token.punctuation {
    color: #9B9B9B;
  }

  .token.tag,
  .token.entity {
    color: #569CD6;
  }

  .token.attr-name,
  .token.namespace,
  .token.deleted,
  .token.property,
  .token.builtin {
    color: #9CDCFE;
  }

  .token.function,
  .token.function-name {
    color: #dcdcaa;
  }

  .token.boolean,
  .token.keyword,
  .token.important {
    color: #569CD6;
  }

  .token.number {
    color: #B8D7A3;
  }

  .token.class-name,
  .token.constant {
    color: #4EC9B0;
  }

  .token.symbol {
    color: #f8c555;
  }

  .token.rule {
    color: #c586c0;
  }

  .token.selector {
    color: #D7BA7D;
  }

  .token.atrule {
    color: #cc99cd;
  }

  .token.string,
  .token.attr-value {
    color: #D69D85;
  }

  .token.char {
    color: #7ec699;
  }

  .token.variable {
    color: #BD63C5;
  }

  .token.regex {
    color: #d16969;
  }

  .token.operator {
    color: #DCDCDC;
    background: transparent;
  }

  .token.url {
    color: #67cdcc;
  }

  .token.important,
  .token.bold {
    font-weight: bold;
  }

  .token.italic {
    font-style: italic;
  }

  .token.entity {
    cursor: help;
  }

  .token.inserted {
    color: green;
  }

  /*---------- code highlight: dark theme for Gist ----------*/
  .gist .gist-file {
    border: 1px solid #555;
  }

  .gist .gist-data {
    background-color: #1e1e1e;
    border-bottom: 1px solid #555;
  }

  .gist .gist-meta {
    background-color: #424a55;
    color: #eee;
  }

  .gist .gist-meta a {
    color: #eee;
  }

  .gist .highlight {
    color: #eee;
    background-color: #1e1e1e;
  }

  .gist .blob-num {
    color: #afafaf;
  }

  .gist .blob-code-inner {
    color: #dfdfdf;
  }

  .pl-mb {
    color: #fff !important;
  }

  .pl-c {
    color: #57A64A !important;
  }

  /* comment */
  .pl-ent {
    color: #569CD6 !important;
  }

  /* entity */
  .pl-e {
    color: #9CDCFE !important;
  }

  .pl-en {
    color: #4EC9B0 !important;
  }

  /* entity attribute */
  .pl-smi {
    color: #9CDCFE !important;
  }

  .pl-k {
    color: #569cd6 !important;
  }

  .pl-c1,
  .pl-s .pl-v {
    color: #4EC9B0 !important;
  }

  .pl-pds,
  .pl-s,
  .pl-s .pl-pse .pl-s1,
  .pl-sr,
  .pl-sr .pl-cce,
  .pl-sr .pl-sra,
  .pl-sr .pl-sre,
  .pl-s .pl-s1 {
    color: #D69D85 !important;
  }

  .pl-s .pl-s1 .pl-pse {
    color: #c5dbff !important;
  }

  /* strings */
  .diff-table .pl-c,
  .diff-table .pl-ent,
  .diff-table .pl-e,
  .diff-table .pl-en,
  .diff-table .pl-pds,
  .diff-table .pl-s,
  .diff-table .pl-s .pl-s1,
  .diff-table .pl-s .pl-pse .pl-s1,
  .diff-table .pl-sr,
  .diff-table .pl-sr .pl-cce,
  .diff-table .pl-sr .pl-sra,
  .diff-table .pl-sr .pl-sre,
  .diff-table .pl-k,
  .diff-table .pl-smi,
  .diff-table .pl-c1,
  .diff-table .pl-v {
    color: #eee !important;
  }

 </style>



###### tags: `GoLang`

# GoLang 編寫技巧:

[]byte-string轉換使用unsafe指針處理unicode速度優異於原始型別直接轉換.
### Go : []byte-string轉換
```go=
package bytesconv
import (
	"unsafe"
)

// StringToBytes converts string to byte slice without a memory allocation.
func StringToBytes(s string) (b []byte) {
	return *(*[]byte)(unsafe.Pointer(
		&struct {
			string
			Cap int
		}{s, len(s)},
	))
}

// BytesToString converts byte slice to string without a memory allocation.
func BytesToString(b []byte) string {
	return *(*string)(unsafe.Pointer(&b))
}
```

### Go : if-else 執行結果效能驗證
```go=
package main

import (
	"log"
	"time"
)

func main() {

	check := 1

	time.Sleep(time.Second * 1)
	counter1 := StartTimer()
	var ss1 string
	for i := 0; i < 9999999999; i++ {
		if check == 0 {
			ss1 = "hhhhhhhhhhhhhhhhhhhhh"
		} else if check == 1 {
			ss1 = "hhhhhhhhhhhhhhhhhhhhh"
		} else {
			ss1 = "hhhhhhhhhhhhhhhhhhhhh"
		}

	}
	println(ss1)
	log.Printf("耗費:%.4f ms", SubTimer(counter1))
	// 	hhhhhhhhhhhhhhhhhhhhh
	// 2019/11/20 20:39:44 耗費:6962.3841 ms

	time.Sleep(time.Second * 1)
	counter2 := StartTimer()
	var ss2 string
	for i := 0; i < 9999999999; i++ {
		if check == 1 {
			ss2 = "hhhhhhhhhhhhhhhhhhhhh"
		} else if check == 0 {
			ss2 = "hhhhhhhhhhhhhhhhhhhhh"
		} else {
			ss2 = "hhhhhhhhhhhhhhhhhhhhh"
		}

	}
	println(ss2)
	log.Printf("耗費:%.4f ms", SubTimer(counter2))
	// 	hhhhhhhhhhhhhhhhhhhhh
	// 2019/11/20 20:39:45 耗費:6586.8364 ms

	time.Sleep(time.Second * 1)
	counter3 := StartTimer()
	var ss3 string
	for i := 0; i < 9999999999; i++ {
		if check == 0 {
			ss3 = "hhhhhhhhhhhhhhhhhhhhh"
		} else if check == 2 {
			ss3 = "hhhhhhhhhhhhhhhhhhhhh"
		} else {
			ss3 = "hhhhhhhhhhhhhhhhhhhhh"
		}

	}
	println(ss3)
	log.Printf("耗費:%.4f ms", SubTimer(counter3))
	// 	hhhhhhhhhhhhhhhhhhhhh
	// 2019/11/20 20:39:46 耗費:6586.8365 ms

	//三者測試結果差異極小，一般而言最常發生狀況應放置於第一個if或是最後才判斷的else
}

func StartTimer() time.Time {
	return time.Now()
}
func SubTimer(input time.Time) float64 {
	return time.Now().Sub(input).Seconds() * 1000
}

```

### Go : Map-Struct 測試效能驗證:
```go=
package main

import (
	"fmt"
	"log"
	"time"
)

type resp struct {
	n     int
	name  string
	data1 string
	data2 string
	data3 string
	data4 string
	data5 string
	data6 string
}

func NewResp(n int, name, data1, data2, data3, data4, data5, data6 string) *resp {
	return &resp{n, name, data1, data2, data3, data4, data5, data6}
}

func (r *resp) Update(n int, name, data1, data2, data3, data4, data5, data6 string) {
	r.n = n
	r.name = name
	r.data1 = data1
	r.data2 = data2
	r.data3 = data3
	r.data4 = data4
	r.data5 = data5
	r.data6 = data6
}

var mp = make(map[string]*resp)

func main() {

	counter1 := StartTimer()
	var resp1 *resp
	for i := 0; i < 9999999; i++ {
		resp1 = NewResp(i, "st", "1", "2", "3", "4", "5", "6")
	}
	fmt.Println(resp1)
	log.Printf("resp1 = NewResp() 耗費:%.4f ms", SubTimer(counter1))
	//2019/11/20 19:58:38 resp1 = NewResp() 耗費:931.1182 ms

	time.Sleep(time.Second * 1)
	counter2 := StartTimer()
	var resp2 resp
	for i := 0; i < 9999999; i++ {
		resp2.Update(i, "st", "1", "2", "3", "4", "5", "6")
	}
	fmt.Println(resp2)
	log.Printf("resp2.Update() 耗費:%.4f ms", SubTimer(counter2))
	//2019/11/20 19:58:38 resp2.Update() 耗費:72.0092 ms

	time.Sleep(time.Second * 1)
	counter3 := StartTimer()
	mp["key"] = &resp{}
	for i := 0; i < 9999999; i++ {
		mp["key"].Update(i, "st", "1", "2", "3", "4", "5", "6")
	}
	fmt.Println(mp["key"])
	delete(mp, "key")
	log.Printf("resp3.Update() 耗費:%.4f ms", SubTimer(counter3))
	//2019/11/20 19:58:38 resp3.Update() 耗費:166.0211 ms

}

func StartTimer() time.Time {
	return time.Now()
}
func SubTimer(input time.Time) float64 {
	return time.Now().Sub(input).Seconds() * 1000
}

```



### Go : interface型別斷言後 測試效能驗證:
```go=
package main
import (
	"fmt"
	"log"
	"strconv"
	"time"
)
func main() {

	intX := 1234567890
	float := 1234567890.0
	str := "1234567890"
	var emif interface{}

	time.Sleep(time.Second * 1)
	counter1 := StartTimer()
	for i := 0; i < 999999; i++ {
		float1, _ := strconv.ParseFloat(fmt.Sprint(str), 64)
		fmt.Sprint(float1)
		float2, _ := strconv.ParseFloat(fmt.Sprint(float), 64)
		fmt.Sprint(float2)
		float3, _ := strconv.ParseFloat(fmt.Sprint(intX), 64)
		fmt.Sprint(float3)
	}
	log.Printf("耗費:%.4f ms", SubTimer(counter1))
	//2021/09/12 12:06:15 耗費:1006.8073 ms

	time.Sleep(time.Second * 1)
	counter2 := StartTimer()
	for i := 0; i < 999999; i++ {
		emif = str
		strif1, _ := emif.(string)
		float1, _ := strconv.ParseFloat(strif1, 64)
		fmt.Sprint(float1)

		emif = float
		strif2, _ := emif.(float64)
		fmt.Sprint(strif2)

		emif = intX
		float3, _ := emif.(int)
		fmt.Sprint(float3)
	}
	log.Printf("耗費:%.4f ms", SubTimer(counter2))
	//2021/09/12 12:06:17 耗費:528.9607 ms
}

func StartTimer() time.Time {
	return time.Now()
}
func SubTimer(input time.Time) float64 {
	return time.Now().Sub(input).Seconds() * 1000
}
```

### Golang Dubug用panic訊息攔截
```go=

package main
import (
	"log"
	"path"
	"runtime"
	"time"
)

func main() {

	defer CachePanic("錯誤攔截1")

	go func() { //每個goroutine,必須要各自defer一次
		defer CachePanic("錯誤攔截2")
		var errorSlice []string
		print(errorSlice[1])
	}()

	// 錯誤攔截2 : 發生嚴重錯誤 Panic.go:17>> runtime error: index out of range
	time.Sleep(1 * time.Second) //等待go func() 結束
}

//攔截Panic，防止非預期錯誤導致當機
func CachePanic(errorTitle string) {
	if err := recover(); err != nil {
		_, file, line, ok := runtime.Caller(3)
		if ok {
			_, filename := path.Split(file)
			log.Printf("%v : 發生嚴重錯誤 %v:%d>> %v", errorTitle, filename, line, err)
		} else {
			log.Printf("%v : 發生嚴重錯誤 >> %v", errorTitle, err)
		}
		return
	}
}


```

### Go : Call Func by name (使用Map):
```go=
package main
import (
	"errors"
	"fmt"
	"reflect"
)

func fc_MapCallFunc(mp_FuncList map[string]interface{}, vs_FuncName string, if_InputArgs ...interface{}) (sl_Output []interface{}, err error) {

	defer func() {
		if err_recover := recover(); err_recover != nil {
			sl_Output = nil
			err = errors.New("fc_MapCallFunc > " + err_recover.(string))
		}
	}()

	ty_FuncValue := reflect.ValueOf(mp_FuncList[vs_FuncName])

	ty_FuncInputs := make([]reflect.Value, len(if_InputArgs))
	for index, value := range if_InputArgs {
		ty_FuncInputs[index] = reflect.ValueOf(value)

	}

	for _, value := range ty_FuncValue.Call(ty_FuncInputs) {
		sl_Output = append(sl_Output, value)
	}

	err = nil

	return

}

func main() {

	var mp_TheFunc = make(map[string]interface{})
	mp_TheFunc["Custom1"] = SayIt
	fc_MapCallFunc(mp_TheFunc, "Custom1", "ba la ba la")
	//fc_MapCallFunc(雜湊表名稱,函數的Key,輸入參數(變數)...)
	//ba la ba la

	println()

	mp_TheFunc["Custom2"] = CalAdder1
	vi_Result2, err := fc_MapCallFunc(mp_TheFunc, "Custom2", 1, 2, 3, 4)
	if err != nil {
		fmt.Printf("%v\n", err)
	} else {
		fmt.Printf("%v\n", vi_Result2[0])
	}
	// CalAdder1() 輸入參數(變數)限定3個，若輸入不正確的參數數量則返回錯誤!
	// fc_MapCallFunc > reflect: Call with too many input arguments
	println()

	mp_TheFunc["Custom3"] = CalAdder2
	vi_Result3, err := fc_MapCallFunc(mp_TheFunc, "Custom3", 1, 2, 3, 4)
	if err != nil {
		fmt.Printf("%v\n", err)
	} else {
		fmt.Printf("%v\n", vi_Result3[0])
		fmt.Printf("%v\n", vi_Result3[1])
	}
	// 第一個輸出 : 10
	// 第二個輸出 : nothing...

}

func SayIt(vs_input string) {
	fmt.Println(vs_input)
}

func CalAdder1(a, b, c int) int {
	return a + b + c
}

func CalAdder2(vi_input ...int) (sum int, nothing string) {
	for _, value := range vi_input {
		sum += value
	}
	nothing = "nothing..."
	return
}

```


### Go : Console輸入介面製作:
```go=
package main
import (
	"bufio"
	"errors"
	"fmt"
	"os"
	"strings"
)

func main() {

	var ty_input Console
	for {
		sl_Output, _ := ty_input.toSliceStr()
		fmt.Printf("%q\n", sl_Output)
	}

	//測試輸入 >  " 1 " 2 3 "4 " " 5" " 六六 " " 七 七 " "八 " " 九" "" " "
	//得到結果 > [" 1 " "2" "3" "4 " " 5" " 六六 " " 七 七 " "八 " " 九" "" " "]
	//引號內的空白將會寫入切片元素中

}

type Console string

func (input Console) toString() (string, error) {
	ty_Scanner := bufio.NewScanner(os.Stdin)
	//ty_Scanner := bufio.NewScanner(strings.NewReader("\" 1 \" 2 3 \"4 \" \" 5\" \" 六六 \" \" 七 七 \" \"八 \" \" 九\" \"\" \" \""))
	if ty_Scanner.Scan() {
		vs_Output := ty_Scanner.Text()
		if strings.Contains(vs_Output, "\r") || strings.Contains(vs_Output, "\n") || strings.Contains(vs_Output, "\t") {
			return "", errors.New("Can't contain ontains : \r \n \t")
		} else if strings.Count(vs_Output, "\"")%2 != 0 {
			return "", errors.New("Must be double-quote characters ( \" )")
		} else {
			return strings.TrimSpace(vs_Output), nil
		}
	} else {
		return "", nil
	}
}

func (input Console) toSliceStr() ([]string, error) {

	ty_Scanner := bufio.NewScanner(os.Stdin)
	//" 1 " 2 3 "4 " " 5" " 六六 " " 七 七 " "八 " " 九" "" " "
	//ty_Scanner := bufio.NewScanner(strings.NewReader("\" 1 \" 2 3 \"4 \" \" 5\" \" 六六 \" \" 七 七 \" \"八 \" \" 九\" \"\" \" \"")) //性能測試用 2019/11/25 14:34:50 耗費:1033.0591 ms
	//1 2 " 3 " "4 " " 5" " 六六 " " 七 七 " "八 " " 九" "" " "
	//ty_Scanner := bufio.NewScanner(strings.NewReader("1 2 \" 3 \" \"4 \" \" 5\" \" 六六 \" \" 七 七 \" \"八 \" \" 九\" \"\" \" \""))
	if ty_Scanner.Scan() {
		vs_Output := ty_Scanner.Text()

		if strings.Contains(vs_Output, "\r") || strings.Contains(vs_Output, "\n") || strings.Contains(vs_Output, "\t") {
			return nil, errors.New("Can't contain ontains : \r \n \t")
		} else if strings.Count(vs_Output, "\"")%2 != 0 {
			return nil, errors.New("Must be double-quote characters ( \" )")
		} else {

			vs_Output = strings.TrimSpace(vs_Output)
			var vi_QutaCount uint64
			for _, value := range []rune(vs_Output) {
				if string(value) == "\"" {
					vi_QutaCount++
					if vi_QutaCount%2 == 1 {
						vs_Output = strings.Replace(vs_Output, "\"", "\r", 1) //<

					} else {
						vs_Output = strings.Replace(vs_Output, "\"", "\n", 1) //>
					}
				}
			}

			vs_Output = strings.ReplaceAll(vs_Output, " \r>", "") //<>

			sl_Output := strings.Split(vs_Output, "\r") //<
			for _, value := range sl_Output {
				vi_ChrIndex := strings.Index(value, "\n") //>
				if vi_ChrIndex > 0 {
					vi_ChrCache := strings.ReplaceAll(value[:vi_ChrIndex+1], " ", "\t") //*
					vs_Output = strings.Replace(vs_Output, value[:vi_ChrIndex+1], vi_ChrCache, 1)
				}
			}

			vs_Output = strings.ReplaceAll(vs_Output, "\r", "") //<
			vs_Output = strings.ReplaceAll(vs_Output, "\n", "") //>

			sl_OutputNew := strings.Split(vs_Output, " ")
			for index, value := range sl_OutputNew {
				sl_OutputNew[index] = strings.ReplaceAll(value, "\t", " ") //*
			}

			return sl_OutputNew, nil
		}

	} else {
		return nil, nil
	}
}

func (input Console) toSliceEMIF() ([]interface{}, error) {

	ty_Scanner := bufio.NewScanner(os.Stdin)
	//" 1 " 2 3 "4 " " 5" " 六六 " " 七 七 " "八 " " 九" "" " "
	//ty_Scanner := bufio.NewScanner(strings.NewReader("\" 1 \" 2 3 \"4 \" \" 5\" \" 六六 \" \" 七 七 \" \"八 \" \" 九\" \"\" \" \"")) //性能測試用 2019/11/25 14:34:50 耗費:1033.0591 ms
	//1 2 " 3 " "4 " " 5" " 六六 " " 七 七 " "八 " " 九" "" " "
	//ty_Scanner := bufio.NewScanner(strings.NewReader("1 2 \" 3 \" \"4 \" \" 5\" \" 六六 \" \" 七 七 \" \"八 \" \" 九\" \"\" \" \""))
	if ty_Scanner.Scan() {
		vs_Output := ty_Scanner.Text()

		if strings.Contains(vs_Output, "\r") || strings.Contains(vs_Output, "\n") || strings.Contains(vs_Output, "\t") {
			return nil, errors.New("Can't contain ontains : \r \n \t")
		} else if strings.Count(vs_Output, "\"")%2 != 0 {
			return nil, errors.New("Must be double-quote characters ( \" )")
		} else {

			vs_Output = strings.TrimSpace(vs_Output)
			var vi_QutaCount uint64
			for _, value := range []rune(vs_Output) {
				if string(value) == "\"" {
					vi_QutaCount++
					if vi_QutaCount%2 == 1 {
						vs_Output = strings.Replace(vs_Output, "\"", "\r", 1) //<

					} else {
						vs_Output = strings.Replace(vs_Output, "\"", "\n", 1) //>
					}
				}
			}

			vs_Output = strings.ReplaceAll(vs_Output, " \r>", "") //<>

			sl_Output := strings.Split(vs_Output, "\r") //<
			for _, value := range sl_Output {
				vi_ChrIndex := strings.Index(value, "\n") //>
				if vi_ChrIndex > 0 {
					vi_ChrCache := strings.ReplaceAll(value[:vi_ChrIndex+1], " ", "\t") //*
					vs_Output = strings.Replace(vs_Output, value[:vi_ChrIndex+1], vi_ChrCache, 1)
				}
			}

			vs_Output = strings.ReplaceAll(vs_Output, "\r", "") //<
			vs_Output = strings.ReplaceAll(vs_Output, "\n", "") //>

			var sl_OutputNew []interface{}
			for _, value := range strings.Split(vs_Output, " ") {
				sl_OutputNew = append(sl_OutputNew, strings.ReplaceAll(value, "\t", " ")) //*
			}

			return sl_OutputNew, nil
		}

	} else {
		return nil, nil
	}
}

```

### Go : goroutine(Timeout並中斷):
```go=
package main

import (
	"log"
	"time"
)

func main() {

	closeTimerCh := make(chan struct{}) //struct{}不占記憶體空間,在此作為關閉goroutine的通道
	go func() {
		startJob(101) //startJob(101) 超過計時器上限100ms，會回報Timeout
		//startJob(50) //startJob(50) 未超國計時器上限100ms，可以正常結束
		closeTimerCh <- struct{}{}
		close(closeTimerCh)
	}()
	
	timeoutCh := time.After(time.Duration(uint(100)) * time.Millisecond)

	select {
	case <-closeTimerCh:
		log.Println("正常結束")
		return
	case <-timeoutCh:
		log.Println("Timeout !")
		return
	}
}

func startJob(count int) {
	for index := 1; index <= count; index++ {
		log.Println(index)
		time.Sleep(1 * time.Millisecond)
	}
}
```

### Go : goroutine(WaitGroup+Timeout中斷):

```go=
package main
import (
	"fmt"
	"log"
	"runtime"
	"sync"
	"time"
)
func main() {
	countGoroutineBefore := runtime.NumGoroutine()
	//Job可依實際需求調整資料結構 --------------------------------
	jobNameMap := make(map[string]uint64) //Job名稱:消費時間
	jobNameMap["Job1"] = 10
	jobNameMap["Job2(超時者)"] = 500
	jobNameMap["Job3(出錯者)"] = 60
	jobNameMap["Job4"] = 100

	jobStatusMap := make(map[string]bool) //Job名稱:是否完成
	jobStatusMap["Job1"] = false
	jobStatusMap["Job2(超時者)"] = false
	jobStatusMap["Job3(出錯者)"] = false
	jobStatusMap["Job4"] = false
	//-----------------------------------------------------------------------------

	JobTimeout := uint64(110) //設置超時計時
	timeoutCh := time.After(time.Duration(JobTimeout) * time.Millisecond) //計數job超時通道
	jobCount := len(jobNameMap)

	closeJobCh := make(chan struct{}) //chan struct{}不占記憶體空間，控制Job-退出無線迴圈使用
	jobDoneCh := make(chan string, jobCount) //傳遞job完成通道,緩存空間必須大於Job數避免阻塞
	jobErrorCh := make(chan error, jobCount) //傳遞job出錯通道,緩存空間必須Job數避免阻塞
	jobWaitGroup := sync.WaitGroup{}

	//此段為講解範例，Job內容依實際需求發起多執行緒--------------------------------
	jobWaitGroup.Add(jobCount) //goroutine數量必須和sync.WaitGroup設置數量相同

	go func(jobWaitGroup *sync.WaitGroup, jobName string, jobCostTime uint64) { //第一個多執行緒Job1:是個能正常結束的工作
		defer jobWaitGroup.Done()
		log.Printf("%v still working... (need %v ms) \n", jobName, jobCostTime)
		time.Sleep(time.Duration(jobCostTime) * time.Millisecond)
		jobDoneCh <- jobName
		return
	}(&jobWaitGroup, "Job1", jobNameMap["Job1"])

	go func(jobWaitGroup *sync.WaitGroup, jobName string, jobCostTime uint64) { //第二個多執行緒Job2:是個不能再規定時間內完成的工作
		defer jobWaitGroup.Done()
		log.Printf("%v still working... (need %v ms) \n", jobName, jobCostTime)
		time.Sleep(time.Duration(jobCostTime) * time.Millisecond)
		//到達此處需要花費 jobCostTime的時間
		jobDoneCh <- jobName
		return
	}(&jobWaitGroup, "Job2(超時者)", jobNameMap["Job2(超時者)"])

	go func(jobWaitGroup *sync.WaitGroup, jobName string, jobCostTime uint64) { //第三個多執行緒Job3:是個會出錯的工作
		defer jobWaitGroup.Done()
		log.Printf("%v still working... (need %v ms) \n", jobName, jobCostTime)
		time.Sleep(time.Duration(jobCostTime) * time.Millisecond)
		err := fmt.Errorf("%v failed", jobName) //強制設置錯誤
		if err != nil {
			jobErrorCh <- err
		} else {
			jobDoneCh <- jobName
		}
		return

	}(&jobWaitGroup, "Job3(出錯者)", jobNameMap["Job3(出錯者)"])

	go func(jobWaitGroup *sync.WaitGroup, jobName string, jobCostTime uint64) { //第四個多執行緒Job4:是個能正常結束的工作
		defer jobWaitGroup.Done()
		log.Printf("%v still working... (need %v ms) \n", jobName, jobCostTime)
		time.Sleep(time.Duration(jobCostTime) * time.Millisecond)
		jobDoneCh <- jobName
		return
	}(&jobWaitGroup, "Job4", jobNameMap["Job4"])

	//-----------------------------------------------------------------------------

	go func() {
		jobWaitGroup.Wait()
		log.Printf("等待Goroutine關閉結束 : %v\n",runtime.NumGoroutine())
		close(closeJobCh)
		return
	}()

	countGoroutineWorking := runtime.NumGoroutine()
	{
	jobLabel:
		for {
			select {
			case name := <-jobDoneCh:
				jobStatusMap[name] = true
				log.Printf("%v Done!\n", name)
			case err := <-jobErrorCh: //依實際狀況調整錯誤處理
				log.Printf("%v Error!\n", err)
			case <-timeoutCh:
				log.Printf("Timeout : over %v ms\n", JobTimeout)
				<-closeJobCh //強制讀取channel避免select阻塞，讓WaitGroup結束等待
				break jobLabel
			case <-closeJobCh:
				log.Printf("All Job Done !\n")
				break jobLabel
			}
		}
	}

	//closeJobCh關閉後才可關閉其他channel，不然會panic
	close(jobDoneCh) 
	close(jobErrorCh)
	countGoroutineAfter := runtime.NumGoroutine()
	log.Printf("最後結果 %v\n", jobStatusMap)
	log.Printf("開始goroutine數量:%v 並行中goroutine數量:%v  結束goroutine數量: %v\n", countGoroutineBefore, countGoroutineWorking, countGoroutineAfter)
}


//-------------------------------------------------------
//2009/11/10 23:00:00 最後結果
//map[Job1:true Job2(超時者):false Job3(出錯者):false Job4:true]
//開始goroutine數量:1 並行中goroutine數量:6  結束goroutine數量: 1

```


### Go : goroutine(context控制)
``一次性中斷所有子goroutine``
```go=
package main

import (
	"context"
	"log"
	"runtime"
	"time"
)

func main() {
	ctx, cancel := context.WithCancel(context.Background())
	go startTask(ctx)
	time.Sleep(1 * time.Millisecond)
	cancel()
	log.Printf("Now,goroutine number : %v", runtime.NumGoroutine())
	time.Sleep(1 * time.Millisecond)
	time.Sleep(1 * time.Millisecond)
	log.Printf("Now,goroutine number : %v", runtime.NumGoroutine())
	log.Println("-- Done --")
	// 2021/02/01 21:45:14 ------
	// 2021/02/01 21:45:14 Task start:
	// 2021/02/01 21:45:14 Still working : task3
	// 2021/02/01 21:45:14 Still working : task2
	// 2021/02/01 21:45:14 Still working : task1
	// 2021/02/01 21:45:14 Now,goroutine number : 5
	// 2021/02/01 21:45:14 Force cancal : task3 (Reason : context deadline exceeded)
	// 2021/02/01 21:45:14 Force cancal : task2 (Reason : context deadline exceeded)
	// 2021/02/01 21:45:14 Force cancal : task1 (Reason : context deadline exceeded)
	// 2021/02/01 21:45:14 Now,goroutine number : 1
	// 2021/02/01 21:45:14 -- Done --
}

func startTask(ctx context.Context) {
	log.Println("------")
	go subTask("task1", ctx)
	go subTask("task2", ctx)
	go subTask("task3", ctx)
	log.Println("Task start:")
}

func subTask(taskName string, ctx context.Context) {
	for {
		select {
		case <-ctx.Done():
			log.Printf("Force cancal : %v (Reason : %v)",taskName, ctx.Err())
			return
		default:
			log.Printf("Still working : %v", taskName)
			time.Sleep(1 * time.Millisecond)
		}
	}
}

```

``timeout後強制中斷所有子goroutine``
```go=
package main

import (
	"context"
	"log"
	"runtime"
	"time"
)

func main() {
	ctx, cancel := context.WithTimeout(context.Background(),time.Millisecond)
	defer cancel()
	go startTask(ctx)
	time.Sleep(1 * time.Millisecond)
	log.Printf("Now,goroutine number : %v", runtime.NumGoroutine())
	time.Sleep(1 * time.Millisecond)
	time.Sleep(1 * time.Millisecond)
	log.Printf("Now,goroutine number : %v", runtime.NumGoroutine())
	log.Println("-- Done --")
	// 2021/02/01 21:46:59 ------
	// 2021/02/01 21:46:59 Task start:
	// 2021/02/01 21:46:59 Still working : task3
	// 2021/02/01 21:46:59 Still working : task2
	// 2021/02/01 21:46:59 Still working : task1
	// 2021/02/01 21:46:59 Now,goroutine number : 4
	// 2021/02/01 21:46:59 Force cancal : task2 (Reason : context canceled)
	// 2021/02/01 21:46:59 Force cancal : task1 (Reason : context canceled)
	// 2021/02/01 21:46:59 Force cancal : task3 (Reason : context canceled)
	// 2021/02/01 21:46:59 Now,goroutine number : 1
	// 2021/02/01 21:46:59 -- Done --
}

func startTask(ctx context.Context) {
	log.Println("------")
	go subTask("task1", ctx)
	go subTask("task2", ctx)
	go subTask("task3", ctx)
	log.Println("Task start:")
}

func subTask(taskName string, ctx context.Context) {
	for {
		select {
		case <-ctx.Done():
			log.Printf("Force cancal : %v (Reason : %v)",taskName, ctx.Err())
			return
		default:
			log.Printf("Still working : %v", taskName)
			time.Sleep(1 * time.Millisecond)
		}
	}
}

```